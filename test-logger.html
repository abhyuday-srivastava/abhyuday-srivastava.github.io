<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Test Visitor Logger</title>
</head>
<body>
  <h1>Visitor Logger Test (with IP & Geo)</h1>
  <p>Open console to check logs. Your Sheet should now have real IP + location.</p>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbws7TsWfU6n3Pw7Sc73lrURSa_NReY0A8XfmCWX1dXVhjR_O4exn8Lf_mDUiw5XMDVL9Q/exec"; 
    // ^ Replace with your deployed Apps Script /exec URL if different

    async function logVisitor() {
      try {
        // Step 1: Get IP + Geo
        let ipData = {};
        try {
          const res = await fetch("https://ipapi.co/json/");
          ipData = await res.json();
        } catch (err) {
          console.warn("‚ö†Ô∏è Could not fetch IP info:", err);
          ipData = {};
        }

        // Step 2: Collect browser info
        const visitorInfo = {
          url: window.location.href,
          referrer: document.referrer || "Direct",
          userAgent: navigator.userAgent,
          language: navigator.language,
          platform: navigator.platform,
          screen: {
            width: window.screen.width,
            height: window.screen.height
          },
          timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,

          // IP + Geo
          ip: ipData.ip || "Unknown",
          city: ipData.city || "Unknown",
          region: ipData.region || "Unknown",
          country: ipData.country_name || "Unknown",
          latitude: ipData.latitude || "Unknown",
          longitude: ipData.longitude || "Unknown"
        };

        console.log("üì§ Sending visitor info:", visitorInfo);

        // Step 3: Send to Google Apps Script
        await fetch(SCRIPT_URL, {
          method: "POST",
          mode: "no-cors", // avoid preflight errors
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(visitorInfo)
        });

        console.log("‚úÖ Visitor info sent (check your Sheet).");
      } catch (err) {
        console.error("‚ùå Logging failed:", err);
      }
    }

    // Auto-run on page load
    window.addEventListener("load", logVisitor);
  </script>
</body>
</html>
